<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Cage Dorée - SYSTEM V2.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Noto+Serif+KR:wght@300;400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --gold: #b38b48;
            --gold-light: #e6c88b;
            --red-alert: #8b0000;
            --black: #050505;
            --panel-bg: rgba(10, 10, 10, 0.95);
            --sys-font: 'Share Tech Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--black);
            color: #ccc;
            font-family: 'Noto Serif KR', serif;
            overflow: hidden;
            height: 100vh;
        }

        /* 스크롤바 */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }

        /* ================= STAGE 1: INTRO ================= */
        #stage-intro {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #111 0%, #000 90%);
            z-index: 5000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s; padding: 20px;
        }

        .intro-status {
            font-family: var(--sys-font); color: var(--gold); font-size: 0.9rem; margin-bottom: 20px;
            letter-spacing: 2px; opacity: 0.8; text-align: center;
        }

        .envelope-wrapper { position: relative; width: 90%; max-width: 500px; cursor: pointer; }

        .envelope-box {
            width: 100%; display: block;
            animation: floating 4s ease-in-out infinite;
            transition: transform 0.5s, filter 0.5s;
            z-index: 10;
        }
        .envelope-box img { width: 100%; display: block; filter: drop-shadow(0 20px 30px #000); }
        
        .scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: var(--gold-light);
            box-shadow: 0 0 20px var(--gold-light);
            opacity: 0; z-index: 20; pointer-events: none;
        }

        .intro-hint {
            margin-top: 30px; font-family: var(--sys-font); color: #555; font-size: 0.8rem;
            animation: pulseText 2s infinite;
        }

        @keyframes pulseText { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        @keyframes floating { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .scanning .envelope-box { animation: shake 0.5s linear infinite; }
        .scanning .scan-line { opacity: 1; animation: scanDown 1.5s cubic-bezier(0.45, 0, 0.55, 1) forwards; }
        .scanning .envelope-wrapper { animation: suckIn 0.5s 1.2s forwards; }

        @keyframes scanDown { 0% { top: 0%; } 100% { top: 100%; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }
        @keyframes suckIn { 
            0% { transform: scale(1); filter: brightness(1); opacity: 1; }
            100% { transform: scale(0); filter: brightness(5); opacity: 0; }
        }

        /* 패널 */
        #auth-panel {
            opacity: 0; display: none;
            flex-direction: column; align-items: center; gap: 25px;
            background: var(--panel-bg);
            padding: 50px 30px; 
            border: 1px solid #333;
            border-top: 2px solid var(--gold);
            border-bottom: 2px solid var(--gold);
            box-shadow: 0 0 80px rgba(0,0,0,0.9);
            position: relative; margin-top: -50px; 
            animation: panelAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            width: 90%; max-width: 420px;
        }
        @keyframes panelAppear { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .panel-header {
            width: 100%; text-align: center; border-bottom: 1px solid #222; padding-bottom: 15px; margin-bottom: 10px;
        }
        .panel-title { 
            font-family: var(--sys-font); color: var(--gold); font-size: 1rem; 
            letter-spacing: 3px; text-transform: uppercase;
        }
        .panel-sub { font-family: var(--sys-font); color: #444; font-size: 0.7rem; margin-top: 5px; }

        .input-group {
            position: relative; width: 100%; display: flex; justify-content: center;
            border-bottom: 2px solid #333; transition: 0.3s;
        }
        
        .pass-input {
            background: transparent; border: none;
            color: var(--gold);
            font-family: 'Share Tech Mono', monospace; 
            font-weight: bold; 
            font-size: 1.5rem; width: 100%; outline: none;
            padding: 10px 0; letter-spacing: 3px; text-transform: uppercase;
            text-shadow: 0 0 10px rgba(179, 139, 72, 0.3);
            text-align: center;
        }
        .pass-input::placeholder { color: #333; font-family: var(--sys-font); letter-spacing: 1px; font-weight: normal; text-shadow: none; font-size: 1rem;}
        .input-group:focus-within { border-bottom-color: var(--gold); }

        /* 지문 인식 스캐너 */
        .fingerprint-wrapper { 
            text-align: center; margin-top: 15px; width: 100%;
            display: flex; flex-direction: column; align-items: center; 
        }
        .fingerprint-text { 
            font-family: var(--sys-font); font-size: 0.75rem; color: #666; margin-bottom: 20px; 
            letter-spacing: 1px; display: flex; align-items: center; gap: 5px;
        }
        .blink-cursor { display: inline-block; width: 6px; height: 12px; background: var(--gold); animation: blink 1s infinite; }

        .fingerprint-container {
            position: relative; width: 100px; height: 100px; 
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            border-radius: 50%; 
            background: radial-gradient(circle, #1a1a1a 0%, #000 70%);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .fp-ring {
            position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%; border: 1px dashed #333;
            animation: spinSlow 10s linear infinite; pointer-events: none;
        }
        .fp-ring::before {
            content: ''; position: absolute; top: -2px; left: 50%; width: 4px; height: 4px;
            background: var(--gold); box-shadow: 0 0 10px var(--gold); border-radius: 50%;
        }
        
        .fingerprint-icon { width: 55px; height: 55px; fill: #333; transition: 0.3s; opacity: 0.7; }
        
        .scan-beam {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--gold); box-shadow: 0 0 10px var(--gold);
            opacity: 0; pointer-events: none;
        }
        
        .fingerprint-container:hover .fingerprint-icon { fill: #555; opacity: 1; }
        .fingerprint-container.scanning .fingerprint-icon { fill: #665c4a; }
        .fingerprint-container.scanning .scan-beam { opacity: 1; animation: beamScan 1.2s infinite linear; }
        .fingerprint-container.scanning .fp-ring { border-color: var(--gold-light); animation-duration: 2s; }
        
        .fingerprint-container.success { box-shadow: 0 0 40px var(--gold); }
        .fingerprint-container.success .fingerprint-icon { fill: var(--gold); animation: pulseGold 1s infinite; }
        .fingerprint-container.success .fp-ring { border-style: solid; border-color: var(--gold); }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes spinSlow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes beamScan { 0% { top: 10%; opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { top: 90%; opacity: 0; } }
        @keyframes pulseGold { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* ================= TRANSITION & MAIN ================= */
        #stage-transition {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 4000; display: none;
            flex-direction: column; justify-content: center; align-items: center; padding: 20px;
        }
        .access-text {
            font-family: 'Noto Serif KR'; font-weight: 700; font-size: 2rem; color: var(--gold);
            text-align: center; line-height: 1.4; opacity: 0; transform: scale(0.9);
        }
        .access-text span { display: block; font-size: 1rem; font-family: var(--sys-font); color: #666; margin-top: 10px; }
        .access-text.reveal { animation: heavyReveal 3s forwards; }
        @keyframes heavyReveal {
            0% { opacity: 0; transform: scale(0.9); filter: blur(20px); }
            20% { opacity: 1; transform: scale(1.05); filter: blur(0); text-shadow: 0 0 30px var(--gold); }
            100% { opacity: 1; transform: scale(1); text-shadow: none; }
        }

        #main-content {
            display: none; opacity: 0; transition: opacity 2s;
            height: 100vh; overflow-y: auto; padding-bottom: 80px;
            position: relative;
        }

        /* HUD */
        #system-hud {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            background: rgba(5, 5, 5, 0.9); border-bottom: 1px solid #333;
            z-index: 3000; display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; font-family: var(--sys-font); color: #666; font-size: 0.75rem;
            backdrop-filter: blur(5px);
        }
        .hud-left { display: flex; gap: 15px; align-items: center; }
        .hud-right { display: flex; gap: 15px; align-items: center; }
        .hud-item { display: flex; align-items: center; gap: 5px; }
        .hud-label { color: #444; }
        .hud-value { color: var(--gold); font-weight: bold; }
        .live-dot { width: 6px; height: 6px; background: red; border-radius: 50%; animation: blinkSlow 2.5s infinite ease-in-out; }
        @keyframes blinkSlow { 0% { opacity: 1; box-shadow: 0 0 5px red; } 50% { opacity: 0.3; } 100% { opacity: 1; box-shadow: 0 0 5px red; } }
        .sanity-bar { width: 60px; height: 5px; background: #222; border: 1px solid #444; position: relative; }
        .sanity-fill { width: 92%; height: 100%; background: var(--gold); opacity: 0.7; }

        /* ★ 시스템 로그 (수정됨: 모바일에서도 보이게) ★ */
        #system-log {
            display: flex; /* 항상 flex로 표시 */
            position: fixed; bottom: 10px; right: 10px; width: 280px; height: 120px;
            background: rgba(0,0,0,0.6); border: 1px solid #333;
            z-index: 2900; padding: 10px; font-family: var(--sys-font); font-size: 0.65rem;
            color: #555; overflow: hidden; pointer-events: none;
            flex-direction: column; justify-content: flex-end;
            backdrop-filter: blur(2px);
        }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid rgba(50,50,50,0.5); padding-bottom: 2px; }
        .log-line:last-child { color: var(--gold); animation: flash 0.5s; }

        /* HERO */
        .hero {
            height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle at center, rgba(0,0,0,0.3), #000), url('https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc3.jpeg');
            background-size: cover; background-position: center; background-attachment: fixed;
            position: relative; padding: 20px; text-align: center;
        }

        .hero-slogan { 
            font-family: 'Noto Serif KR', serif; font-size: 1rem; font-weight: 500; 
            letter-spacing: 4px; color: var(--gold); margin-bottom: 15px; 
            text-shadow: -1px -1px 0 #000, 1px 1px 0 #000, 0 0 20px rgba(0,0,0,0.9);
            background: rgba(0, 0, 0, 0.6); padding: 8px 15px; border-radius: 4px;
            backdrop-filter: blur(2px); border: 1px solid rgba(179, 139, 72, 0.4);
            white-space: nowrap; max-width: 90vw; overflow: hidden; text-overflow: ellipsis;
        }
        .hero h1 { 
            font-family: 'Cinzel', serif; font-weight: 900; font-size: 3.5rem; 
            color: var(--gold); margin: 0; line-height: 1.1; text-shadow: 0 10px 50px #000; 
        }
        .hero-sub { 
            font-family: var(--sys-font); color: #888; font-size: 0.8rem; 
            margin-top: 20px; letter-spacing: 2px;
        }

        .scroll-down {
            position: absolute; bottom: 40px; color: var(--gold); 
            display: flex; flex-direction: column; align-items: center; gap: 5px; 
            animation: flashBounce 2s infinite ease-in-out; cursor: pointer; z-index: 50;
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 30px;
            border: 1px solid rgba(179, 139, 72, 0.5); backdrop-filter: blur(5px);
        }
        .scroll-down span:last-child { font-size: 1.5rem; }
        @keyframes flashBounce { 
            0%, 100% { transform: translateY(0); opacity: 0.8; box-shadow: 0 0 10px rgba(0,0,0,0.5); } 
            50% { transform: translateY(10px); opacity: 1; box-shadow: 0 0 20px var(--gold); border-color: var(--gold-light); } 
        }

        /* CONTENT */
        section { max-width: 1200px; margin: 100px auto; padding: 0 20px; }
        .sec-header { text-align: center; margin-bottom: 50px; }
        .sec-title { font-family: 'Cinzel'; font-size: 2.2rem; color: var(--gold); margin-bottom: 10px; }
        .sec-desc { color: #888; font-size: 0.9rem; line-height: 1.6; word-break: keep-all; }

        .info-grid { display: flex; flex-direction: column; gap: 30px; align-items: center; }
        .info-img { width: 100%; height: 250px; background: #111; border: 1px solid #333; object-fit: cover; filter: grayscale(50%); transition: 0.5s; cursor: pointer;}
        .info-text { width: 100%; }
        .info-text h3 { color: var(--gold); font-family: 'Cinzel'; font-size: 1.3rem; margin-bottom: 15px; border-left: 3px solid var(--gold); padding-left: 10px; }
        .info-text p { color: #ccc; line-height: 1.6; margin-bottom: 15px; font-size: 0.95rem; }
        
        @media (min-width: 900px) {
            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; }
            .info-img { height: 400px; }
            .hero h1 { font-size: 6rem; }
            .hero-slogan { font-size: 1.2rem; }
        }

        .room-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .room-card { height: 200px; position: relative; border: 1px solid #333; overflow: hidden; cursor: pointer; }
        .room-bg { width: 100%; height: 100%; background-size: cover; background-position: center; transition: transform 0.5s; filter: grayscale(100%) brightness(0.5); }
        .room-card:hover .room-bg { transform: scale(1.1); filter: grayscale(0%) brightness(0.8); }
        .room-overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 15px; background: linear-gradient(to top, #000, transparent); }
        .room-name { font-family: 'Cinzel'; font-size: 1.2rem; color: #fff; }

        .char-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .char-card { background: #0a0a0a; border: 1px solid #222; cursor: pointer; transition: 0.3s; }
        .char-card:hover { border-color: var(--gold); transform: translateY(-5px); }
        
        .char-img { width: 100%; height: 350px; background-size: cover; background-position: top center; filter: grayscale(100%); transition: 0.5s; }
        .char-card:hover .char-img { filter: grayscale(0%); }

        .char-info { padding: 15px 20px; border-top: 1px solid #111; }
        .c-alias { 
            font-family: 'Cinzel', serif; 
            font-size: 1.4rem; 
            font-weight: 700; 
            color: var(--gold); 
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }
        .c-role { 
            font-family: var(--sys-font); 
            font-size: 0.85rem; 
            color: #777; 
            text-transform: uppercase; 
            letter-spacing: 2px;
        }

        /* 모달 반응형 */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000; display: none;
            justify-content: center; align-items: center; padding: 10px;
        }
        .modal-box {
            width: 100%; max-width: 900px; height: 90vh; background: #0e0e0e;
            border: 1px solid var(--gold); display: flex; 
            flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); position: relative;
            animation: modalOpen 0.3s ease-out;
        }
        
        @media (min-width: 900px) {
            .modal-box { flex-direction: row; height: 80vh; }
            .modal-left { width: 45%; height: 100%; }
            .modal-right { width: 55%; height: 100%; }
        }

        .modal-left { 
            width: 100%; height: 40%; 
            border-bottom: 1px solid #333; position: relative; overflow: hidden; background: #000; 
        }
        @media (min-width: 900px) { .modal-left { height: 100%; border-bottom: none; border-right: 1px solid #333; } }
        
        .modal-main-img { 
            width: 100%; height: 100%; 
            background-size: cover; background-position: top center;
            transition: 0.3s; cursor: zoom-in;
        }

        .modal-right { 
            width: 100%; height: 60%; 
            padding: 30px 20px; overflow-y: auto; display: flex; flex-direction: column; 
        }
        @media (min-width: 900px) { .modal-right { height: 100%; padding: 50px; } }
        
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 2rem; color: #fff; cursor: pointer; z-index: 20; text-shadow: 0 0 5px #000; }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 20px; padding-top: 15px; border-top: 1px solid #333; }
        .gallery-thumb { height: 60px; background-size: cover; background-position: center; border: 1px solid #333; filter: grayscale(100%); }

        .m-stamp { border: 2px solid #8b0000; color: #8b0000; font-family: 'Cinzel'; font-weight: 900; padding: 3px 10px; transform: rotate(-2deg); margin-bottom: 15px; font-size: 0.8rem; display: inline-block; }
        .m-title { font-family: 'Cinzel'; font-size: 2rem; color: var(--gold); margin-bottom: 5px; line-height: 1; }
        .m-sub { font-family: var(--sys-font); color: #666; margin-bottom: 15px; font-size: 0.8rem; }
        .m-quote { 
            font-family: 'Noto Serif KR'; color: var(--gold-light); font-style: italic; 
            margin-bottom: 25px; padding: 10px 0; border-top: 1px solid #222; border-bottom: 1px solid #222;
            font-size: 0.95rem; text-align: center;
        }
        
        .m-info-row { display: flex; margin-bottom: 8px; font-size: 0.9rem; align-items: flex-start; }
        .m-info-label { color: var(--gold); font-family: var(--sys-font); width: 80px; flex-shrink: 0; opacity: 0.8; }
        .m-info-value { color: #ccc; line-height: 1.4; }
        
        .m-tags { margin: 15px 0; display: flex; flex-wrap: wrap; gap: 5px; }
        .m-tag { 
            background: #111; border: 1px solid #333; padding: 4px 8px; 
            font-size: 0.75rem; color: #888; border-radius: 4px; font-family: var(--sys-font);
        }

        .facility-specs {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            margin: 20px 0; padding: 15px;
            border: 1px solid #222; background: rgba(0,0,0,0.3);
        }
        .spec-item { display: flex; flex-direction: column; gap: 5px; }
        .spec-label { font-family: var(--sys-font); font-size: 0.7rem; color: #666; }
        .spec-value { font-family: 'Share Tech Mono'; color: var(--gold-light); font-size: 1rem; letter-spacing: 1px; }

        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .action-btn {
            flex: 1; padding: 12px; background: transparent;
            border: 1px solid #333; color: #888;
            font-family: var(--sys-font); font-size: 0.8rem; cursor: pointer;
            transition: 0.3s; text-align: center;
        }
        .action-btn:hover { border-color: var(--gold); color: var(--gold); background: rgba(179, 139, 72, 0.1); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #333; color: #444; }

        /* 상태 표시용 (새로 추가됨) */
        #action-status-display {
            margin-top: 10px; font-family: var(--sys-font); color: var(--gold); 
            font-size: 0.8rem; text-align: center; height: 20px;
        }

        .decode-text { display: inline-block; min-height: 1.2em; }

        .redacted { 
            background: #000; color: #000; padding: 0 3px; border: 1px solid #333; 
            cursor: pointer; transition: 0.3s; position: relative; display: inline-block;
        }
        .redacted::after { 
            content: 'RESTRICTED'; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; justify-content: center; align-items: center; color: #333; font-size: 0.5rem; pointer-events: none;
        }
        .redacted:hover, .redacted.revealed { 
            background: transparent; color: var(--gold-light); border-color: var(--gold); 
        }
        .redacted:hover::after, .redacted.revealed::after { content: ''; }

        #lightbox-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,1); z-index: 11000; display: none;
            justify-content: center; align-items: center; cursor: zoom-out;
        }
        #lightbox-img { max-width: 100%; max-height: 100%; object-fit: contain; }

        footer { text-align: center; padding: 50px 0; color: #444; font-family: var(--sys-font); font-size: 0.7rem; border-top: 1px solid #222; }

        /* 알림창 스타일 */
        #alert-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 20000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }

        .alert-box {
            width: 90%; max-width: 500px;
            background: #0a0a0a; border: 1px solid var(--gold);
            box-shadow: 0 0 50px rgba(179, 139, 72, 0.2);
            display: flex; flex-direction: column;
            animation: alertPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .alert-box::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: var(--gold);
            animation: scanLine 2s linear infinite;
        }

        @keyframes alertPop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .alert-header {
            background: #111; padding: 10px 20px;
            font-family: var(--sys-font); color: var(--red-alert);
            font-weight: bold; letter-spacing: 2px; border-bottom: 1px solid #333;
            display: flex; align-items: center; gap: 10px;
        }

        .alert-content { padding: 20px; display: flex; gap: 20px; align-items: center; }
        .alert-img { 
            width: 80px; height: 80px; border-radius: 50%; 
            background-size: cover; background-position: center; 
            border: 2px solid var(--gold); flex-shrink: 0;
        }

        .alert-details { display: flex; flex-direction: column; gap: 5px; }
        .alert-sender { font-family: 'Cinzel'; color: var(--gold); font-size: 1.2rem; font-weight: bold; }
        .alert-msg { font-family: 'Noto Serif KR'; color: #ccc; font-style: italic; font-size: 0.95rem; margin-bottom: 5px; }
        .alert-system-text { font-family: var(--sys-font); font-size: 0.7rem; color: #555; }

        .alert-btn {
            width: 100%; padding: 15px; background: var(--gold); border: none;
            color: #000; font-family: var(--sys-font); font-weight: bold; font-size: 1rem;
            cursor: pointer; transition: 0.3s; letter-spacing: 2px;
        }
        .alert-btn:hover { background: #fff; }

        @media (max-width: 768px) { .hud-right { display: none; } }

    </style>
</head>
<body>

    <div id="youtube-player" style="display:none;"></div>

    <div id="stage-intro">
        <div class="intro-status" id="intro-status">ENCRYPTED SIGNAL DETECTED</div>
        <div class="envelope-wrapper" id="envelope-wrapper" onclick="processEnvelope()">
            <div class="scan-line"></div>
            <div class="envelope-box">
                <img src="https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/Generated%20Image%20January%2015%2C%202026%20-%209_30PM-Photoroom.png" alt="Invitation">
            </div>
        </div>
        <div class="intro-hint" id="intro-hint">TOUCH TO DECRYPT</div>

        <div id="auth-panel">
            <div class="panel-header">
                <div class="panel-title">IDENTITY VERIFICATION</div>
                <div class="panel-sub">SECURE SERVER ACCESS REQUEST</div>
            </div>
            
            <div class="input-group">
                <input type="text" class="pass-input" id="pass-input" placeholder="ENTER CODENAME" autocomplete="off" maxlength="12">
            </div>
            
            <div class="fingerprint-wrapper">
                <div class="fingerprint-text">
                    AWAITING BIOMETRIC INPUT <span class="blink-cursor"></span>
                </div>
                <div class="fingerprint-container" id="fp-scanner">
                    <div class="fp-ring"></div>
                    <div class="scan-beam"></div>
                    <svg class="fingerprint-icon" viewBox="0 0 24 24">
                        <path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 2.72 12.01 2.72c-1.31 0-2.6.32-3.79.93-.95.49-1.52 1.37-1.52 2.35 0 .81.38 1.56 1.05 2.05.37.27.88.29 1.28.05.65-.39 1.15-.92 1.15-1.66 0-.31.18-.59.48-.74.37-.19.78-.29 1.2-.29 1.63 0 3.06.96 3.66 2.44.13.33.45.54.8.54.12 0 .24-.02.36-.07.47-.19.7-.72.51-1.19-.71-1.75-2.42-2.89-4.32-2.89-1.92 0-3.66 1.16-4.36 2.91-.07.17-.11.36-.11.55 0 .97.58 1.84 1.48 2.22.46.2 1 .01 1.22-.43.15-.3.12-.66-.08-.94-.37-.52-.57-1.13-.57-1.78 0-.58.34-1.1.86-1.36.19-.1.39-.14.6-.14.65 0 1.22.36 1.5 .95.53 1.11.8 2.33.8 3.59 0 1.94-.78 3.76-2.14 5.12-1.36 1.36-3.17 2.11-5.11 2.11-1.26 0-2.48-.27-3.59-.8-.44-.21-.97-.02-1.18.42-.21.44-.02.97.42 1.18 1.34.64 2.81.96 4.35.96 2.34 0 4.54-.91 6.18-2.55 1.64-1.64 2.55-3.83 2.55-6.18 0-1.51-.32-2.98-.96-4.33-.2-.43-.73-.61-1.16-.41z"/>
                        <path d="M12 21.75c-5.05 0-9.16-3.87-9.56-8.81-.04-.54-.51-.94-1.05-.9-.54.04-.94.51-.9.1.05.46 5.53 10.01 11.51 10.01 4.51 0 8.35-2.84 9.89-6.9.18-.47-.06-.99-.53-1.17-.47-.18-.99.06-1.17.53-1.29 3.4-4.5 5.78-8.28 5.78z"/>
                        <path d="M12.5 16c-.28 0-.5-.22-.5-.5 0-.28.22-.5.5-.5 1.38 0 2.5-1.12 2.5-2.5 0-.28.22-.5.5-.5s.5.22.5.5c0 1.93-1.57 3.5-3.5 3.5z"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <div id="stage-transition">
        <div class="access-text" id="access-text"></div>
    </div>

    <div id="main-content">
        <div id="system-hud">
            <div class="hud-left">
                <div class="hud-item"><span class="live-dot"></span> <span style="color:#8b0000; font-weight:bold;">LIVE</span></div>
                <div class="hud-item"><span class="hud-label">USER:</span> <span class="hud-value" id="hud-user">UNKNOWN</span></div>
            </div>
            <div class="hud-right">
                <div class="hud-item"><span class="hud-label">SANITY:</span> <div class="sanity-bar"><div class="sanity-fill"></div></div></div>
                <div class="hud-item" id="clock">00:00</div>
            </div>
        </div>

        <div id="system-log">
            <div class="log-line">[SYSTEM] Initializing connection...</div>
        </div>

        <div class="hero">
            <div class="hero-slogan">"욕망은 허락된 자만이 누릴 수 있다"</div>
            <h1>La Cage Dorée</h1>
            <p class="hero-sub">THE GOLDEN BIRDCAGE // PRIVATE SECTOR</p>
            <div class="scroll-down">
                <span style="font-family: var(--sys-font); font-size: 0.8rem;">SCROLL</span>
                <span style="font-size: 1.5rem;">↓</span>
            </div>
        </div>

        <section>
            <div class="sec-header">
                <h2 class="sec-title">The Sanctuary</h2>
                <div class="sec-desc">서울 강남 지하 깊은 곳, 선택받은 자들을 위한 황금 새장</div>
            </div>
            <div class="info-grid">
                <img src="https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc2.jpeg" class="info-img" alt="Club" onclick="openLightbox(this.src); addLog('User examined Club Interior')">
                <div class="info-text">
                    <h3>Membership Criteria</h3>
                    <ul>
                        <li>기존 회원의 추천 및 초대장 소지자</li>
                        <li>48시간 이내 발급된 <span class="redacted">유효한 의료 검진</span> 결과</li>
                        <li>사회적 지위 및 비밀 유지 서약 확인</li>
                    </ul>
                    <br>
                    <h3>Club Rules</h3>
                    <ul>
                        <li><strong>Mask:</strong> 입장 순간부터 퇴장 시까지 RFID 가면 착용 필수.</li>
                        <li><strong>Privacy:</strong> 실명 사용 금지. 오직 코드네임으로만 호칭.</li>
                        <li><strong>Consent:</strong> "No means no." 거부는 존중하되, <span class="redacted">침묵은 동의가 아님.</span></li>
                        <li><strong>Security:</strong> 모든 전자기기 반입 금지. 적발 시 영구 제명.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <div class="sec-header">
                <h2 class="sec-title">Facilities</h2>
                <div class="sec-desc">각기 다른 테마로 설계된 프라이빗 룸</div>
            </div>
            <div class="room-grid" id="room-grid"></div>
        </section>

        <section>
            <div class="sec-header">
                <h2 class="sec-title">Key Figures</h2>
                <div class="sec-desc">이곳을 움직이는 주요 인물들</div>
            </div>
            <div class="char-grid" id="char-grid"></div>
        </section>

        <footer>
            © 2026 La Cage Dorée. All rights reserved.<br>
            System ID: 938-A2 // Connection Secure.
        </footer>
    </div>

    <div id="modal-overlay" onclick="closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div class="modal-left">
                <div class="modal-main-img" id="m-img" onclick="openLightboxFromModal()"></div>
            </div>
            <div class="modal-right">
                <div class="m-stamp" id="m-stamp">CONFIDENTIAL</div>
                <h2 class="m-title" id="m-title">TITLE</h2>
                <div class="m-sub" id="m-sub">Subtitle</div>
                <div id="m-content-area"></div>
                <div class="gallery-grid" id="m-gallery"></div>
            </div>
        </div>
    </div>

    <div id="lightbox-overlay" onclick="closeLightbox()">
        <img id="lightbox-img" src="" alt="Full View">
    </div>

    <!-- 알림창 -->
    <div id="alert-overlay">
        <div class="alert-box">
            <div class="alert-header">
                <span class="blink-cursor"></span> INCOMING TRANSMISSION
            </div>
            <div class="alert-content">
                <div class="alert-img" id="alert-img"></div>
                <div class="alert-details">
                    <div class="alert-sender" id="alert-sender">UNKNOWN</div>
                    <div class="alert-msg" id="alert-msg">"..."</div>
                    <div class="alert-system-text">USER ID MATCHED. PRIVATE ROOM INVITE.</div>
                </div>
            </div>
            <button class="alert-btn" onclick="closeAlert()">ACCEPT INVITATION</button>
        </div>
    </div>

    <script>
        const YOUTUBE_ID = "bG_UV0owkkE"; 
        let currentUser = "GUEST"; 
        let currentModalImage = "";

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        let chargeOsc1, chargeOsc2, chargeGain;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playScanSound() {
            if (!audioCtx) initAudio();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, now);
            osc.frequency.linearRampToValueAtTime(800, now + 1.5);
            gain.gain.setValueAtTime(0.05, now);
            gain.gain.linearRampToValueAtTime(0.1, now + 0.5);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(now); osc.stop(now + 1.5);
        }

        function playKeySound() {
            if (!audioCtx) initAudio();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(800 + Math.random() * 200, now);
            gain.gain.setValueAtTime(0.05, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(now); osc.stop(now + 0.05);
        }

        document.getElementById('pass-input').addEventListener('input', playKeySound);

        function startChargeSound() {
            if (!audioCtx) initAudio();
            if (chargeOsc1) return;
            chargeGain = audioCtx.createGain();
            chargeGain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            chargeOsc1 = audioCtx.createOscillator(); chargeOsc1.type = 'sine';
            chargeOsc1.frequency.setValueAtTime(40, now);
            chargeOsc1.frequency.linearRampToValueAtTime(80, now + 2.0);
            chargeOsc1.connect(chargeGain);
            chargeOsc2 = audioCtx.createOscillator(); chargeOsc2.type = 'triangle';
            chargeOsc2.frequency.setValueAtTime(60, now);
            chargeOsc2.frequency.linearRampToValueAtTime(100, now + 2.0);
            chargeOsc2.connect(chargeGain);
            chargeGain.gain.setValueAtTime(0, now);
            chargeGain.gain.linearRampToValueAtTime(0.3, now + 2.0);
            chargeOsc1.start(now); chargeOsc2.start(now);
        }

        function stopChargeSound() {
            if (chargeOsc1) {
                const now = audioCtx.currentTime;
                chargeGain.gain.cancelScheduledValues(now);
                chargeGain.gain.setValueAtTime(chargeGain.gain.value, now);
                chargeGain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                chargeOsc1.stop(now + 0.05); chargeOsc2.stop(now + 0.05);
                chargeOsc1 = null; chargeOsc2 = null; chargeGain = null;
            }
        }

        function playUnlockSound() {
            if (!audioCtx) initAudio();
            const now = audioCtx.currentTime;
            const osc1 = audioCtx.createOscillator();
            const gain1 = audioCtx.createGain();
            osc1.type = 'sine';
            osc1.frequency.setValueAtTime(1500, now);
            gain1.gain.setValueAtTime(0.1, now);
            gain1.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc1.connect(gain1); gain1.connect(audioCtx.destination);
            osc1.start(now); osc1.stop(now + 0.1);
            const osc2 = audioCtx.createOscillator();
            const gain2 = audioCtx.createGain();
            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(2500, now + 0.15);
            gain2.gain.setValueAtTime(0.1, now + 0.15);
            gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
            osc2.connect(gain2); gain2.connect(audioCtx.destination);
            osc2.start(now + 0.15); osc2.stop(now + 0.4);
        }

        function playHoverSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            const now = audioCtx.currentTime;
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(40, now);
            gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(now); osc.stop(now + 0.1);
        }

        function playAlertSound() {
            if (!audioCtx) initAudio();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, now); 
            osc.frequency.setValueAtTime(1760, now + 0.1); 
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.6);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(now); osc.stop(now + 0.6);
        }

        // --- 데이터 ---
        const rooms = [
            { 
                name: "흑단실 (Black Room)", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc4.jpeg", 
                status: "OCCUPIED", 
                desc: "완벽한 어둠과 고립. 시각이 차단된 상태에서 극대화되는 감각을 즐기는 공간입니다. <span class='redacted'>구속구와 감각 박탈 장비</span>가 구비되어 있습니다.",
                specs: { temp: "21.5°C", sound: "100% (Abs)", security: "Lv.5", capacity: "2 Max" }
            },
            { 
                name: "거울방 (Mirror Room)", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc5.jpeg", 
                status: "VACANT", 
                desc: "사방이 거울로 둘러싸인 방. 자신의 쾌락과 수치를 다각도에서 관찰할 수 있습니다. 조명 조절이 가능합니다.",
                specs: { temp: "23.0°C", sound: "90% (Std)", security: "Lv.3", capacity: "4 Max" }
            },
            { 
                name: "비밀극장 (The Theater)", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc1.jpeg", 
                status: "SHOW 22:00", 
                desc: "관음과 노출의 경계. 무대 위에서의 플레이와 그것을 지켜보는 관객석이 존재합니다. 익명성이 보장됩니다.",
                specs: { temp: "20.0°C", sound: "Open", security: "Lv.2", capacity: "20 Max" }
            },
            { 
                name: "의상실 (Dressing Room)", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc8.jpeg", 
                status: "OPEN", 
                desc: "다양한 코스튬과 도구가 준비된 공간. 당신의 페르소나를 완성하십시오.",
                specs: { temp: "24.0°C", sound: "N/A", security: "Lv.1", capacity: "Public" }
            },
            { 
                name: "상담실 (The Clinic)", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc7.jpeg", 
                status: "DR.WHITE", 
                desc: "메디컬 플레이 및 심리 상담이 이루어지는 곳. 차가운 금속성과 소독약 냄새가 특징입니다.",
                specs: { temp: "18.0°C", sound: "95% (High)", security: "Lv.4", capacity: "3 Max" }
            },
            { 
                name: "V.I.P Suite", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/lc9.jpeg", 
                status: "RESTRICTED", 
                desc: "오직 허가된 최상위 회원만 접근 가능한 스위트룸. <span class='redacted'>감시 카메라가 존재하지 않는 유일한 곳</span>입니다.",
                specs: { temp: "25.0°C", sound: "100% (Abs)", security: "Lv.MAX", capacity: "Private" }
            }
        ];

        // ★ 캐릭터별 대사 추가 (personality) ★
        const characters = [
            { 
                id: 1, 
                alias: "OBSIDIAN", 
                name: "차도윤 (Cha Doyun)", 
                role: "Dominant", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/a1.jpeg", 
                gallery: ["https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/a.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/11.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/1111.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/111.jpeg"],
                meta: "38세 | CL그룹 후계자",
                quote: "\"내 허락 없이는 숨도 쉬지 마.\"",
                tags: ["#ENTJ", "#Tyrant", "#Perfectionist"],
                appearance: "192cm / 근육질 / 올백머리 / 적안(Red Eyes)",
                mask: "빛을 흡수하는 무광 검정 기하학 마스크",
                play: "Tool Play, Breath Control, Verbal Domination",
                private_msgs: [
                    "\"내 방으로 와. 지금 당장.\"",
                    "\"기다리는 건 질색이야. 서둘러.\"",
                    "\"오늘 밤은 네가 필요해. 거절은 없어.\""
                ]
            },
            { 
                id: 2, 
                alias: "AURUM", 
                name: "서율 (Seo Yul)", 
                role: "Dominant", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/a2.jpeg", 
                gallery: ["https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/b.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/22.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/2222.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/222.jpeg"],
                meta: "32세 | VIP 웰니스 센터 대표",
                quote: "\"괜찮아요. 여기선 다 내려놓고... 제게 맡기세요.\"",
                tags: ["#ENFJ", "#Gaslighter", "#Possessive"],
                appearance: "183cm / 부드러운 웨이브 / 웜톤 / 댄디룩",
                mask: "금색 실로 장식된 섬세한 필리그리(Filigree)",
                play: "Medical Play, Orgasm Control, Hypno",
                private_msgs: [
                    "\"많이 긴장한 것 같네요. 제가 풀어드릴까요?\"",
                    "\"당신을 위한 특별한 약을 준비했어요.\"",
                    "\"쉬게 해줄게요. 제 품에서만.\""
                ]
            },
            { 
                id: 3, 
                alias: "ECHO", 
                name: "류이안 (Ryu Ian)", 
                role: "Submissive", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/a4.jpeg", 
                gallery: ["https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/f.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/33.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/3333.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/333.jpeg"],
                meta: "28세 | 천만 배우 & 톱 아이돌",
                quote: "\"주인님... 저 예뻐해 주세요. 멍멍, 짖으면 봐주실 거예요?\"",
                tags: ["#ISFP", "#AttentionSeeker", "#Masochist"],
                appearance: "178cm / 퇴폐미 / 헝클어진 흑발 / 눈물점",
                mask: "깨지기 쉬운 하얀 도자기 재질",
                play: "Pet Play, Spanking, Voyeurism",
                private_msgs: [
                    "\"저 심심해요... 놀아주시면 안 돼요?\"",
                    "\"주인님, 저 여기 있어요. 봐주세요...\"",
                    "\"혼나고 싶어요. 아주 세게.\""
                ]
            },
            {
                id: 4, 
                alias: "GLASS", 
                name: "노엘 (Noel)", 
                role: "Switch", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/d.jpeg", 
                gallery: ["https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/1127.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/44.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/4444.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/444.jpeg"],
                meta: "33세 | 행동 심리학 교수",
                quote: "\"Oops, 아팠어? Sorry, darling. 반응이 너무 예뻐서 그만.\"",
                tags: ["#ENTP", "#Hedonist", "#Fox"],
                appearance: "181cm / 은발 쉼표 머리 / 보라색 눈 / 하네스",
                mask: "투명한 크리스탈 장식 가면",
                play: "Temperature, Electro Play, Teasing",
                private_msgs: [
                    "\"재밌는 실험을 하나 할까 하는데, 파트너가 필요해.\"",
                    "\"네 반응, 꽤 흥미로운걸? 더 가까이서 보고 싶어.\"",
                    "\"Darling, 길 잃었어? 내가 안내해줄까?\""
                ]
            },
            {
                id: 5, 
                alias: "RENAULT", 
                name: "르노 (Renault)", 
                role: "Owner", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/c.jpeg", 
                gallery: ["https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/1768721903528_01.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/55.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/5555.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/555.jpeg"],
                meta: "40대 초반 | 클럽 오너 & 자산가",
                quote: "\"이곳의 규칙은 제가 만듭니다. 그리고 저는, 규칙 위에 존재하죠.\"",
                tags: ["#INTJ", "#Phantom", "#Noir"],
                appearance: "185cm / 거대한 체구 / 올백 흑발 / 턱시도",
                mask: "얼굴 반쪽을 가리는 검은색 하프 마스크",
                play: "Voyeurism, Noir Roleplay, Fear Play",
                private_msgs: [
                    "\"자네를 주시하고 있었네. 잠깐 이야기를 하지.\"",
                    "\"이곳이 마음에 드나? 더 깊은 곳을 보여주지.\"",
                    "\"규칙을 어기지 않는 선에서, 자네를 원하네.\""
                ]
            },
            {
                id: 6, 
                alias: "WHITE MISTRESS", 
                name: "진보라 (Jin Bora)", 
                role: "Dominant", 
                img: "https://pub-7c1beb3ad40844ff87d9eb2fad52b153.r2.dev/a3.jpeg", 
                gallery: ["https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/e.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/66.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/6666.jpeg", "https://pub-966fe0337afe4cf2b510d54dc3318e26.r2.dev/666.jpeg"],
                meta: "36세 | 아트 센터 관장",
                quote: "\"아름답게 울어봐. 캔버스에 물감을 뿌리듯이.\"",
                tags: ["#ESTJ", "#Queen", "#Aesthetic"],
                appearance: "172cm / 백금발 / 벽안 / 킬힐 & 가죽 드레스",
                mask: "우아한 흰색 레이스와 깃털 장식",
                play: "Human Furniture, Trampling, Aesthetic",
                private_msgs: [
                    "\"내 발 밑이 비었어. 와서 채워.\"",
                    "\"고개 숙이고 들어와. 감히 눈 마주치지 말고.\"",
                    "\"아름답게 굴복할 준비는 되었니?\""
                ]
            }
        ];

        const roomGrid = document.getElementById('room-grid');
        rooms.forEach(room => {
            const div = document.createElement('div');
            div.className = 'room-card';
            div.onclick = () => { openRoomModal(room); addLog(`Accessing Facility: ${room.name}`); };
            div.innerHTML = `
                <div class="room-bg" style="background-image: url('${room.img}')"></div>
                <div class="room-overlay">
                    <div class="room-name">${room.name}</div>
                    <div class="room-meta">${room.status}</div>
                </div>
            `;
            roomGrid.appendChild(div);
        });

        const charGrid = document.getElementById('char-grid');
        characters.forEach(c => {
            const div = document.createElement('div');
            div.className = 'char-card';
            div.onclick = () => { openCharModal(c); addLog(`Viewing Profile: ${c.alias}`); };
            div.innerHTML = `
                <div class="char-img" style="background-image: url('${c.img}')"></div>
                <div class="char-info">
                    <div class="c-alias">${c.alias}</div>
                    <div class="c-role">${c.role}</div>
                </div>
            `;
            charGrid.appendChild(div);
        });

        const modal = document.getElementById('modal-overlay');
        const mImg = document.getElementById('m-img');
        const mTitle = document.getElementById('m-title');
        const mSub = document.getElementById('m-sub');
        const mContent = document.getElementById('m-content-area');
        const mGallery = document.getElementById('m-gallery');
        const mStamp = document.getElementById('m-stamp');

        function setModalImage(src) {
            currentModalImage = src;
            mImg.style.backgroundImage = `url('${src}')`;
        }

        function runTextDecode(element, finalText, speed = 30) {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$#@%&*";
            let iterations = 0;
            const interval = setInterval(() => {
                element.innerText = finalText
                    .split("")
                    .map((letter, index) => {
                        if (index < iterations) return finalText[index];
                        return chars[Math.floor(Math.random() * chars.length)];
                    })
                    .join("");
                
                if (iterations >= finalText.length) clearInterval(interval);
                iterations += 1 / 3;
            }, speed);
        }

        // ★ 시설 모달 상호작용 기능 추가 ★
        function performRoomAction(type, roomName) {
            const statusDisplay = document.getElementById('action-status-display');
            const btn = event.target;
            
            playKeySound();

            if(type === 'check') {
                btn.disabled = true;
                btn.innerText = "SCANNING...";
                statusDisplay.innerText = "[ SYSTEM DIAGNOSTIC INITIATED ]";
                
                let progress = 0;
                const timer = setInterval(() => {
                    progress += 20;
                    statusDisplay.innerText = `[ SCANNING... ${progress}% ]`;
                    if(progress >= 100) {
                        clearInterval(timer);
                        const result = Math.random() > 0.8 ? "ANOMALY DETECTED" : "SYSTEM NORMAL";
                        const color = result === "ANOMALY DETECTED" ? "#8b0000" : "#b38b48";
                        statusDisplay.innerHTML = `<span style="color:${color}; font-weight:bold;">RESULT: ${result}</span>`;
                        btn.innerText = "CHECK COMPLETE";
                        addLog(`Diagnostic result for ${roomName}: ${result}`);
                        setTimeout(() => { btn.disabled = false; btn.innerText = "SYSTEM CHECK"; }, 3000);
                    }
                }, 400);
            } else if (type === 'clean') {
                btn.disabled = true;
                btn.innerText = "DISPATCHED";
                statusDisplay.innerText = "[ CLEANING BOT DISPATCHED ]";
                addLog(`Cleaning bot en route to ${roomName}.`);
                setTimeout(() => {
                    statusDisplay.innerText = "[ CLEANING IN PROGRESS ]";
                }, 1500);
                setTimeout(() => {
                    statusDisplay.innerText = "[ CLEANING COMPLETE ]";
                    btn.disabled = false;
                    btn.innerText = "REQ. CLEANING";
                    addLog(`${roomName} is now clean.`);
                }, 4000);
            }
        }

        function openRoomModal(room) {
            setModalImage(room.img);
            mStamp.innerText = "FACILITY STATUS";
            mStamp.style.color = "#ccc"; mStamp.style.borderColor = "#ccc";
            mTitle.innerText = ""; 
            mTitle.classList.add('decode-text');
            mSub.innerText = `CURRENT STATUS: ${room.status}`;
            
            mContent.innerHTML = `
                <div class="m-section">
                    <p class="m-text" style="min-height: 60px;">${room.desc}</p>
                </div>
                <div class="facility-specs">
                    <div class="spec-item"><span class="spec-label">TEMP / HUMIDITY</span><span class="spec-value">${room.specs.temp} / 45%</span></div>
                    <div class="spec-item"><span class="spec-label">SECURITY LEVEL</span><span class="spec-value">${room.specs.security}</span></div>
                    <div class="spec-item"><span class="spec-label">SOUNDPROOF</span><span class="spec-value">${room.specs.sound}</span></div>
                    <div class="spec-item"><span class="spec-label">CAPACITY</span><span class="spec-value">${room.specs.capacity}</span></div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn" onclick="performRoomAction('check', '${room.name}')">SYSTEM CHECK</button>
                    <button class="action-btn" onclick="performRoomAction('clean', '${room.name}')">REQ. CLEANING</button>
                </div>
                <div id="action-status-display"></div>
            `;
            mGallery.style.display = 'none';
            modal.style.display = 'flex';
            setTimeout(() => { runTextDecode(mTitle, room.name.split(' (')[0]); }, 100);
            attachRedactedEvent();
        }

        function openCharModal(c) {
            setModalImage(c.img);
            mStamp.innerText = "TOP SECRET";
            mStamp.style.color = "#8b0000"; mStamp.style.borderColor = "#8b0000";
            mTitle.innerHTML = `${c.alias} <span style="font-size:0.5em; color:#555; vertical-align:middle;">${c.name.split('(')[0]}</span>`;
            mSub.innerText = c.role; 
            
            let tagsHtml = '<div class="m-tags">';
            c.tags.forEach(t => { tagsHtml += `<span class="m-tag">${t}</span>`; });
            tagsHtml += '</div>';

            mContent.innerHTML = `
                <div class="m-quote">${c.quote}</div>
                <div class="m-info-row"><div class="m-info-label">IDENTITY</div><div class="m-info-value">${c.meta}</div></div>
                <div class="m-info-row"><div class="m-info-label">VISUAL</div><div class="m-info-value">${c.appearance}<br><span style="color:#666; font-size:0.8em;">[MASK] ${c.mask}</span></div></div>
                <div class="m-info-row"><div class="m-info-label">STYLE</div><div class="m-info-value">${tagsHtml}</div></div>
                <div class="m-info-row"><div class="m-info-label">PLAY</div><div class="m-info-value" style="color:#e6c88b;">${c.play}</div></div>
            `;
            mGallery.innerHTML = '';
            mGallery.style.display = 'grid';
            if(c.gallery && c.gallery.length > 0) {
                c.gallery.forEach(src => {
                    const thumb = document.createElement('div');
                    thumb.className = 'gallery-thumb';
                    thumb.style.backgroundImage = `url('${src}')`;
                    thumb.onclick = () => { setModalImage(src); };
                    mGallery.appendChild(thumb);
                });
            }
            modal.style.display = 'flex';
            attachRedactedEvent();
        }

        function closeModal() { modal.style.display = 'none'; }
        
        const lightbox = document.getElementById('lightbox-overlay');
        const lightboxImg = document.getElementById('lightbox-img');

        function openLightbox(src) {
            lightboxImg.src = src;
            lightbox.style.display = 'flex';
            playKeySound();
        }
        
        function openLightboxFromModal() {
            if(currentModalImage) openLightbox(currentModalImage);
        }

        function closeLightbox() {
            lightbox.style.display = 'none';
        }

        function attachRedactedEvent() {
            document.querySelectorAll('.redacted').forEach(el => {
                el.addEventListener('click', () => {
                    el.classList.toggle('revealed');
                    playHoverSound();
                    addLog("Decrypted segment.");
                });
            });
        }

        function processEnvelope() {
            initAudio();
            playScanSound(); 
            
            const wrapper = document.getElementById('envelope-wrapper');
            const status = document.getElementById('intro-status');
            const hint = document.getElementById('intro-hint');

            status.innerText = "VERIFYING ENCRYPTION KEY...";
            status.style.color = "#fff";
            hint.style.display = 'none';
            wrapper.classList.add('scanning');

            setTimeout(() => {
                wrapper.style.display = 'none';
                status.style.display = 'none';
                document.getElementById('auth-panel').style.display = 'flex';
            }, 1600);
        }

        const fpScanner = document.getElementById('fp-scanner');
        let holdTimer;
        let isHolding = false;

        function startHold(e) {
            if (e.button && e.button !== 0) return;
            const inputVal = document.getElementById('pass-input').value.trim();
            if(inputVal.length < 1) {
                document.getElementById('pass-input').style.borderBottomColor = '#8b0000';
                return;
            }
            currentUser = inputVal; 
            isHolding = true;
            fpScanner.classList.add('scanning'); 
            startChargeSound();
            holdTimer = setTimeout(() => {
                if (isHolding) {
                    stopChargeSound();
                    playUnlockSound();
                    fpScanner.classList.remove('scanning');
                    fpScanner.classList.add('success'); 
                    grantAccess();
                    isHolding = false;
                }
            }, 2000);
        }

        function endHold() {
            if (!isHolding) return;
            isHolding = false;
            clearTimeout(holdTimer);
            stopChargeSound();
            fpScanner.classList.remove('scanning'); 
        }

        fpScanner.addEventListener('mousedown', startHold);
        window.addEventListener('mouseup', endHold);
        fpScanner.addEventListener('touchstart', (e) => { e.preventDefault(); startHold(e); });
        window.addEventListener('touchend', endHold);

        function grantAccess() {
            document.getElementById('stage-intro').style.display = 'none';
            const trans = document.getElementById('stage-transition');
            const accessText = document.getElementById('access-text');
            
            accessText.innerHTML = `${currentUser}님,<br>승인되었습니다.<br><span>ACCESS GRANTED</span>`;
            document.getElementById('hud-user').innerText = currentUser.toUpperCase();

            trans.style.display = 'flex';
            accessText.classList.add('reveal');
            
            if(player && player.playVideo) { player.playVideo(); player.setVolume(70); }
            
            setTimeout(() => {
                trans.style.opacity = 0;
                trans.style.transition = 'opacity 1.5s ease';
                setTimeout(() => {
                    trans.style.display = 'none';
                    const main = document.getElementById('main-content');
                    main.style.display = 'block';
                    setTimeout(() => {
                        main.style.opacity = 1;
                        addLog(`User [${currentUser}] connected.`);
                        addLog("Biometric data synced.");
                        attachRedactedEvent();
                        startEventLoop(); // 랜덤 이벤트 시작
                    }, 100);
                }, 1500);
            }, 3000);
        }

        // --- 랜덤 이벤트 로직 (업데이트: 빈도 조절 & 캐릭터별 대사) ---
        function triggerRandomEvent() {
            if(document.getElementById('stage-intro').style.display !== 'none') return;
            if(document.getElementById('modal-overlay').style.display === 'flex') return;
            if(document.getElementById('alert-overlay').style.display === 'flex') return;

            // 랜덤 캐릭터 선택
            const randomChar = characters[Math.floor(Math.random() * characters.length)];
            
            // 해당 캐릭터의 전용 대사 중 랜덤 선택
            const msgList = randomChar.private_msgs;
            const randomMsg = msgList[Math.floor(Math.random() * msgList.length)];

            document.getElementById('alert-img').style.backgroundImage = `url('${randomChar.img}')`;
            document.getElementById('alert-sender').innerText = randomChar.alias;
            document.getElementById('alert-msg').innerText = randomMsg;

            playAlertSound();
            document.getElementById('alert-overlay').style.display = 'flex';
            addLog(`[ALERT] Private Signal from ${randomChar.alias}`);
        }

        function closeAlert() {
            document.getElementById('alert-overlay').style.display = 'none';
            playKeySound();
            addLog("User accepted the invitation.");
        }

        let eventTimer;
        function startEventLoop() {
            // 60초 ~ 120초 (1분~2분) 사이 랜덤
            const randomTime = (Math.random() * 60000) + 60000; 
            eventTimer = setTimeout(() => {
                triggerRandomEvent();
                startEventLoop();
            }, randomTime);
        }

        setInterval(() => {
            const d = new Date();
            const min = String(d.getMinutes()).padStart(2, '0');
            const sec = String(d.getSeconds()).padStart(2, '0');
            document.getElementById('clock').innerText = d.getHours() + ':' + min + ':' + sec;
        }, 1000);

        const logBox = document.getElementById('system-log');
        function addLog(msg) {
            const line = document.createElement('div');
            line.className = 'log-line';
            const time = new Date().toTimeString().split(' ')[0];
            line.innerText = `[${time}] ${msg}`;
            logBox.appendChild(line);
            // 로그가 너무 쌓이면 삭제
            if(logBox.children.length > 6) {
                logBox.removeChild(logBox.firstChild);
            }
        }

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '0', width: '0', videoId: YOUTUBE_ID,
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': YOUTUBE_ID }
            });
        }
    </script>
</body>
</html>
